<% content_for :page_title, "학습 분석" %>

<!-- Header Section -->
<div class="dashboard-header text-center">
  <h1 class="dashboard-title">📊 학습 분석</h1>
  <p class="dashboard-subtitle">학습 패턴을 분석하여<br>효과적인 학습 방향을 제시합니다</p>
</div>

<!-- Overall Performance -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">🎯 전체 성과</h3>
  </div>
  <div class="card-content">
    <div class="dashboard-stats">
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-header">
          <span class="dashboard-stat-title">전체 평균</span>
          <span class="dashboard-stat-icon">📊</span>
        </div>
        <div class="dashboard-stat-value"><%= @analytics_stats[:overall_avg] || 78 %>점</div>
        <div class="dashboard-stat-change dashboard-stat-change--positive">
          <span>↗️ +12점 상승</span>
        </div>
      </div>
      
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-header">
          <span class="dashboard-stat-title">완료 퀴즈</span>
          <span class="dashboard-stat-icon">✅</span>
        </div>
        <div class="dashboard-stat-value"><%= @analytics_stats[:completed_quizzes] || 18 %>/54</div>
        <div class="dashboard-stat-change dashboard-stat-change--neutral">
          <span>33% 완료</span>
        </div>
      </div>
      
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-header">
          <span class="dashboard-stat-title">학습 시간</span>
          <span class="dashboard-stat-icon">⏱️</span>
        </div>
        <div class="dashboard-stat-value"><%= @analytics_stats[:total_study_time] || 12.5 %>시간</div>
        <div class="dashboard-stat-change dashboard-stat-change--positive">
          <span>이번 주 +3.2시간</span>
        </div>
      </div>
      
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-header">
          <span class="dashboard-stat-title">연속 학습</span>
          <span class="dashboard-stat-icon">🔥</span>
        </div>
        <div class="dashboard-stat-value"><%= @analytics_stats[:study_streak] || 7 %>일</div>
        <div class="dashboard-stat-change dashboard-stat-change--positive">
          <span>최고 기록!</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Subject Performance Chart -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">📈 과목별 성과</h3>
  </div>
  <div class="card-content">
    <div class="analytics-chart">
      
      <!-- Subject Performance Item 1 -->
      <div class="analytics-subject-item">
        <div class="analytics-subject-header">
          <div class="analytics-subject-info">
            <span class="subject-badge subject-badge--subject-1">자금세탁방지법</span>
            <span class="analytics-subject-score">평균 85점</span>
          </div>
          <span class="analytics-subject-trend analytics-subject-trend--up">↗️ +8점</span>
        </div>
        <div class="analytics-progress-container">
          <div class="analytics-progress-bar">
            <div class="analytics-progress-fill analytics-progress-fill--subject-1" style="width: 85%"></div>
          </div>
          <span class="analytics-progress-label">85% 완료</span>
        </div>
        <div class="analytics-subject-stats">
          <span>퀴즈: 9/9</span>
          <span>오답: 3개</span>
          <span>학습시간: 3.2시간</span>
        </div>
      </div>

      <!-- Subject Performance Item 2 -->
      <div class="analytics-subject-item">
        <div class="analytics-subject-header">
          <div class="analytics-subject-info">
            <span class="subject-badge subject-badge--subject-3">의심거래신고</span>
            <span class="analytics-subject-score">평균 92점</span>
          </div>
          <span class="analytics-subject-trend analytics-subject-trend--up">↗️ +5점</span>
        </div>
        <div class="analytics-progress-container">
          <div class="analytics-progress-bar">
            <div class="analytics-progress-fill analytics-progress-fill--subject-3" style="width: 90%"></div>
          </div>
          <span class="analytics-progress-label">90% 완료</span>
        </div>
        <div class="analytics-subject-stats">
          <span>퀴즈: 8/9</span>
          <span>오답: 1개</span>
          <span>학습시간: 2.8시간</span>
        </div>
      </div>

      <!-- Subject Performance Item 3 -->
      <div class="analytics-subject-item">
        <div class="analytics-subject-header">
          <div class="analytics-subject-info">
            <span class="subject-badge subject-badge--subject-2">고객확인제도</span>
            <span class="analytics-subject-score">평균 78점</span>
          </div>
          <span class="analytics-subject-trend analytics-subject-trend--up">↗️ +2점</span>
        </div>
        <div class="analytics-progress-container">
          <div class="analytics-progress-bar">
            <div class="analytics-progress-fill analytics-progress-fill--subject-2" style="width: 72%"></div>
          </div>
          <span class="analytics-progress-label">72% 완료</span>
        </div>
        <div class="analytics-subject-stats">
          <span>퀴즈: 6/9</span>
          <span>오답: 5개</span>
          <span>학습시간: 2.5시간</span>
        </div>
      </div>

      <!-- Subject Performance Item 4 -->
      <div class="analytics-subject-item analytics-subject-item--weak">
        <div class="analytics-subject-header">
          <div class="analytics-subject-info">
            <span class="subject-badge subject-badge--subject-4">고객관리</span>
            <span class="analytics-subject-score">평균 65점</span>
          </div>
          <span class="analytics-subject-trend analytics-subject-trend--down">↘️ -3점</span>
        </div>
        <div class="analytics-progress-container">
          <div class="analytics-progress-bar">
            <div class="analytics-progress-fill analytics-progress-fill--subject-4" style="width: 40%"></div>
          </div>
          <span class="analytics-progress-label">40% 완료</span>
        </div>
        <div class="analytics-subject-stats">
          <span>퀴즈: 3/9</span>
          <span>오답: 8개</span>
          <span>학습시간: 1.8시간</span>
        </div>
        <div class="analytics-subject-recommendation">
          <span class="badge badge--warning">⚠️ 집중 학습 필요</span>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Weekly Progress -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">📅 주간 학습 현황</h3>
  </div>
  <div class="card-content">
    <div class="analytics-weekly-chart">
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">월</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 60%"></div>
        </div>
        <div class="analytics-weekly-value">1.2시간</div>
      </div>
      
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">화</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 80%"></div>
        </div>
        <div class="analytics-weekly-value">1.6시간</div>
      </div>
      
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">수</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 45%"></div>
        </div>
        <div class="analytics-weekly-value">0.9시간</div>
      </div>
      
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">목</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 100%"></div>
        </div>
        <div class="analytics-weekly-value">2.0시간</div>
      </div>
      
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">금</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 70%"></div>
        </div>
        <div class="analytics-weekly-value">1.4시간</div>
      </div>
      
      <div class="analytics-weekly-item">
        <div class="analytics-weekly-day">토</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 90%"></div>
        </div>
        <div class="analytics-weekly-value">1.8시간</div>
      </div>
      
      <div class="analytics-weekly-item analytics-weekly-item--today">
        <div class="analytics-weekly-day">일</div>
        <div class="analytics-weekly-bar">
          <div class="analytics-weekly-fill" style="height: 30%"></div>
        </div>
        <div class="analytics-weekly-value">0.6시간</div>
      </div>
    </div>
    
    <div style="margin-top: var(--space-4); text-align: center;">
      <span class="dashboard-subtitle">일일 평균: 1.4시간 • 이번 주 총합: 9.5시간</span>
    </div>
  </div>
</div>

<!-- Strengths and Weaknesses -->
<div class="analytics-insights">
  <div class="analytics-insight-card analytics-insight-card--strength">
    <div class="analytics-insight-header">
      <span class="analytics-insight-icon">💪</span>
      <h3 class="analytics-insight-title">강점 분야</h3>
    </div>
    <div class="analytics-insight-content">
      <div class="analytics-insight-item">
        <span class="subject-badge subject-badge--subject-3">의심거래신고</span>
        <span class="analytics-insight-score">92점 평균</span>
      </div>
      <div class="analytics-insight-item">
        <span class="subject-badge subject-badge--subject-1">자금세탁방지법</span>
        <span class="analytics-insight-score">85점 평균</span>
      </div>
      <ul class="analytics-insight-list">
        <li>• 법조문 이해력 우수</li>
        <li>• 실무 사례 적용 능력 높음</li>
        <li>• 꾸준한 학습 패턴 유지</li>
      </ul>
    </div>
  </div>
  
  <div class="analytics-insight-card analytics-insight-card--weakness">
    <div class="analytics-insight-header">
      <span class="analytics-insight-icon">🎯</span>
      <h3 class="analytics-insight-title">개선 필요</h3>
    </div>
    <div class="analytics-insight-content">
      <div class="analytics-insight-item">
        <span class="subject-badge subject-badge--subject-4">고객관리</span>
        <span class="analytics-insight-score">65점 평균</span>
      </div>
      <div class="analytics-insight-item">
        <span class="subject-badge subject-badge--subject-5">내부통제</span>
        <span class="analytics-insight-score">미시작</span>
      </div>
      <ul class="analytics-insight-list">
        <li>• 실무 절차 부분 보완 필요</li>
        <li>• 심화 문제 정답률 낮음</li>
        <li>• 복습 주기 조정 권장</li>
      </ul>
    </div>
  </div>
</div>

<!-- Study Recommendations -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">💡 맞춤 학습 제안</h3>
  </div>
  <div class="card-content">
    <div class="analytics-recommendations">
      <div class="analytics-recommendation-item analytics-recommendation-item--urgent">
        <div class="analytics-recommendation-header">
          <span class="analytics-recommendation-priority">🔴 긴급</span>
          <span class="analytics-recommendation-title">고객관리 집중 학습</span>
        </div>
        <p class="analytics-recommendation-description">
          평균 점수가 65점으로 다른 과목 대비 낮습니다. 기초 개념부터 차근차근 복습하는 것을 권장합니다.
        </p>
        <div class="button-group">
          <%= link_to quiz_path(subject: 4, difficulty: 'basic'), class: "button button--outline button--sm" do %>
            기초 퀴즈 시작
          <% end %>
          <%= link_to study_guide_path(subject: 4), class: "button button--outline button--sm" do %>
            학습 가이드
          <% end %>
        </div>
      </div>
      
      <div class="analytics-recommendation-item">
        <div class="analytics-recommendation-header">
          <span class="analytics-recommendation-priority">🟡 권장</span>
          <span class="analytics-recommendation-title">오답 노트 복습</span>
        </div>
        <p class="analytics-recommendation-description">
          15개의 오답이 누적되어 있습니다. 정기적인 복습으로 약점을 보완하세요.
        </p>
        <div class="button-group">
          <%= link_to wrong_answers_path, class: "button button--outline button--sm" do %>
            오답 노트 확인
          <% end %>
          <%= link_to new_wrong_answer_quiz_path, class: "button button--outline button--sm" do %>
            오답 퀴즈
          <% end %>
        </div>
      </div>
      
      <div class="analytics-recommendation-item">
        <div class="analytics-recommendation-header">
          <span class="analytics-recommendation-priority">🟢 제안</span>
          <span class="analytics-recommendation-title">학습 시간 조정</span>
        </div>
        <p class="analytics-recommendation-description">
          현재 일평균 1.4시간 학습 중입니다. 목표 달성을 위해 일일 2시간 학습을 권장합니다.
        </p>
        <div class="button-group">
          <%= link_to study_schedule_path, class: "button button--outline button--sm" do %>
            학습 계획 수정
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Goal Progress -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">🎯 목표 달성률</h3>
  </div>
  <div class="card-content">
    <div class="analytics-goals">
      <div class="analytics-goal-item">
        <div class="analytics-goal-header">
          <span class="analytics-goal-title">TPAC 시험 준비</span>
          <span class="analytics-goal-percentage">67%</span>
        </div>
        <div class="analytics-progress-bar">
          <div class="analytics-progress-fill" style="width: 67%; background: var(--success-500);"></div>
        </div>
        <div class="analytics-goal-description">
          예상 시험 점수: 78점 / 합격 기준: 80점
        </div>
      </div>
      
      <div class="analytics-goal-item">
        <div class="analytics-goal-header">
          <span class="analytics-goal-title">전 과목 완주</span>
          <span class="analytics-goal-percentage">33%</span>
        </div>
        <div class="analytics-progress-bar">
          <div class="analytics-progress-fill" style="width: 33%; background: var(--primary-500);"></div>
        </div>
        <div class="analytics-goal-description">
          완료: 18/54 퀴즈 • 예상 완료일: 6주 후
        </div>
      </div>
      
      <div class="analytics-goal-item">
        <div class="analytics-goal-header">
          <span class="analytics-goal-title">연속 학습 30일</span>
          <span class="analytics-goal-percentage">23%</span>
        </div>
        <div class="analytics-progress-bar">
          <div class="analytics-progress-fill" style="width: 23%; background: var(--warning-500);"></div>
        </div>
        <div class="analytics-goal-description">
          현재: 7일 연속 • 목표: 30일 연속
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="button-group button-group--analytics-actions" style="margin-top: var(--space-6);">
  <%= link_to export_analytics_path, class: "button button--outline" do %>
    📊 리포트 내보내기
  <% end %>
  
  <%= link_to study_plan_path, class: "button button--outline" do %>
    📅 학습 계획 수정
  <% end %>
  
  <%= link_to dashboard_path, class: "button button--primary" do %>
    🏠 홈으로 돌아가기
  <% end %>
</div>

<style>
.analytics-chart {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.analytics-subject-item {
  padding: var(--space-4);
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-lg);
  transition: all 0.2s ease;
}

.analytics-subject-item:hover {
  border-color: var(--gray-300);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.analytics-subject-item--weak {
  border-color: var(--warning-300);
  background: var(--warning-25);
}

.analytics-subject-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-3);
}

.analytics-subject-info {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.analytics-subject-score {
  font-weight: var(--font-bold);
  font-size: var(--text-lg);
}

.analytics-subject-trend {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
}

.analytics-subject-trend--up {
  color: var(--success-600);
}

.analytics-subject-trend--down {
  color: var(--error-600);
}

.analytics-progress-container {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-3);
}

.analytics-progress-bar {
  flex: 1;
  height: 8px;
  background: var(--gray-200);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.analytics-progress-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width 0.3s ease;
}

.analytics-progress-fill--subject-1 {
  background: var(--subject-1-500);
}

.analytics-progress-fill--subject-2 {
  background: var(--subject-2-500);
}

.analytics-progress-fill--subject-3 {
  background: var(--subject-3-500);
}

.analytics-progress-fill--subject-4 {
  background: var(--subject-4-500);
}

.analytics-progress-label {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  min-width: 60px;
  text-align: right;
}

.analytics-subject-stats {
  display: flex;
  gap: var(--space-4);
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.analytics-subject-recommendation {
  margin-top: var(--space-2);
}

.analytics-weekly-chart {
  display: flex;
  justify-content: space-between;
  align-items: end;
  height: 120px;
  padding: var(--space-4) 0;
}

.analytics-weekly-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-2);
  flex: 1;
}

.analytics-weekly-item--today {
  opacity: 0.7;
}

.analytics-weekly-day {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--text-secondary);
}

.analytics-weekly-bar {
  width: 20px;
  height: 60px;
  background: var(--gray-100);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: end;
  overflow: hidden;
}

.analytics-weekly-fill {
  width: 100%;
  background: var(--primary-500);
  border-radius: var(--radius-sm);
  transition: height 0.3s ease;
}

.analytics-weekly-value {
  font-size: var(--text-xs);
  color: var(--text-secondary);
  text-align: center;
}

.analytics-insights {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-4);
  margin: var(--space-6) 0;
}

.analytics-insight-card {
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  border: 1px solid var(--gray-200);
}

.analytics-insight-card--strength {
  background: var(--success-25);
  border-color: var(--success-200);
}

.analytics-insight-card--weakness {
  background: var(--warning-25);
  border-color: var(--warning-200);
}

.analytics-insight-header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  margin-bottom: var(--space-3);
}

.analytics-insight-icon {
  font-size: var(--text-xl);
}

.analytics-insight-title {
  font-size: var(--text-lg);
  font-weight: var(--font-bold);
  margin: 0;
}

.analytics-insight-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-2);
}

.analytics-insight-score {
  font-weight: var(--font-medium);
  font-size: var(--text-sm);
}

.analytics-insight-list {
  list-style: none;
  padding: 0;
  margin: var(--space-3) 0 0 0;
}

.analytics-insight-list li {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  margin-bottom: var(--space-1);
}

.analytics-recommendations {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.analytics-recommendation-item {
  padding: var(--space-4);
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-lg);
}

.analytics-recommendation-item--urgent {
  border-color: var(--error-300);
  background: var(--error-25);
}

.analytics-recommendation-header {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-2);
}

.analytics-recommendation-priority {
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
}

.analytics-recommendation-title {
  font-size: var(--text-base);
  font-weight: var(--font-bold);
}

.analytics-recommendation-description {
  font-size: var(--text-sm);
  line-height: var(--leading-relaxed);
  color: var(--text-secondary);
  margin-bottom: var(--space-3);
}

.analytics-goals {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.analytics-goal-item {
  padding: var(--space-3);
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-md);
}

.analytics-goal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-2);
}

.analytics-goal-title {
  font-weight: var(--font-medium);
}

.analytics-goal-percentage {
  font-weight: var(--font-bold);
  font-size: var(--text-lg);
}

.analytics-goal-description {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  margin-top: var(--space-2);
}

.button-group--analytics-actions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-3);
}

@media (max-width: 768px) {
  .analytics-insights {
    grid-template-columns: 1fr;
  }
  
  .analytics-subject-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2);
  }
  
  .analytics-subject-stats {
    flex-direction: column;
    gap: var(--space-1);
  }
  
  .analytics-weekly-chart {
    gap: var(--space-1);
  }
  
  .analytics-weekly-bar {
    width: 16px;
  }
  
  .button-group--analytics-actions {
    grid-template-columns: 1fr;
  }
}
</style>