<% content_for :page_title, "퀴즈" %>
<% content_for :back_button do %>
  <%= link_to quiz_selection_path, class: "mobile-header-back" do %>
    <span class="mobile-header-back-icon">←</span>
  <% end %>
<% end %>

<!-- Answer Result Alert -->
<% if @is_correct %>
  <div class="alert alert--quiz-success">
    <div class="alert-content">
      <div class="alert-icon">✅</div>
      <div class="alert-text">
        <h3 class="alert-title">정답입니다!</h3>
        <p class="alert-description">+<%= @current_quiz&.points || 5 %>점 획득</p>
      </div>
    </div>
  </div>
<% else %>
  <div class="alert alert--quiz-incorrect">
    <div class="alert-content">
      <div class="alert-icon">❌</div>
      <div class="alert-text">
        <h3 class="alert-title">틀렸습니다</h3>
        <p class="alert-description">오답 노트에 추가되었습니다</p>
      </div>
    </div>
  </div>
<% end %>

<!-- Answer Review -->
<div class="card card--<%= @is_correct ? 'quiz' : 'wrong-answer' %>">
  <div class="card-header">
    <h3 class="card-title">정답 확인</h3>
  </div>
  
  <div class="card-content">
    <div class="dashboard-stats">
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-title">정답</div>
        <div class="dashboard-stat-value" style="color: var(--success-600);">
          <%= @current_quiz&.correct_answer || "C" %>. <%= @current_quiz&.answer_text || "1000만원 이상" %>
        </div>
      </div>
      
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-title">당신의 답안</div>
        <div class="dashboard-stat-value" style="color: <%= @is_correct ? 'var(--success-600)' : 'var(--error-600)' %>;">
          <%= @selected_answer || "C" %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Explanation -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">💡 해설</h3>
  </div>
  
  <div class="card-content">
    <p class="quiz-explanation">
      <%= @current_quiz&.explanation || "자금세탁방지법 제4조에 따라 1000만원 이상의 거래 시 고객확인의무가 발생합니다. 이는 금융기관의 핵심 의무사항 중 하나입니다." %>
    </p>
    
    <div style="margin-top: var(--space-4);">
      <h4 class="card-title">📚 관련 법조문</h4>
      <ul style="margin: var(--space-2) 0; padding-left: var(--space-4);">
        <li>• 자금세탁방지법 제4조</li>
        <li>• 시행령 제7조</li>
      </ul>
    </div>
  </div>
</div>

<!-- Action Buttons -->
<div class="button-group" style="margin-top: var(--space-6);">
  <% if @quiz_session&.current_quiz_index && @quiz_session.current_quiz_index < 20 %>
    <%= link_to next_question_path(@quiz_session), class: "button button--next-question button--lg w-full" do %>
      다음 문제
    <% end %>
  <% else %>
    <%= link_to quiz_result_path(@quiz_session), class: "button button--view-results button--lg w-full" do %>
      결과 보기
    <% end %>
  <% end %>
</div>

<!-- Additional Actions -->
<div class="button-group button-group--horizontal" style="margin-top: var(--space-4);">
  <button class="button button--outline" onclick="toggleBookmark()">
    <span>🔖</span>
    <span>북마크</span>
  </button>
  
  <button class="button button--outline" onclick="addNote()">
    <span>📝</span>
    <span>메모</span>
  </button>
</div>

<!-- Quiz Completion Modal -->
<% if @show_completion %>
  <div class="dialog-overlay open">
    <div class="dialog dialog--confirmation success">
      <div class="dialog-content">
        <div class="dialog-icon">🎉</div>
        <h3 class="dialog-title">퀴즈 완료!</h3>
        <p class="dialog-message">
          모든 문제를 완료했습니다.<br>
          최종 결과를 확인하세요.
        </p>
      </div>
      
      <div class="dialog-footer">
        <%= link_to quiz_result_path(@quiz_session), class: "button button--success button--lg" do %>
          결과 확인
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<style>
.quiz-explanation {
  line-height: var(--leading-relaxed);
  color: var(--text-primary);
  font-size: var(--text-base);
}

.alert--quiz-success {
  background: var(--success-50);
  border-color: var(--success-300);
  color: var(--success-800);
}

.alert--quiz-incorrect {
  background: var(--error-50);
  border-color: var(--error-300);
  color: var(--error-800);
}
</style>

<script>
function toggleBookmark() {
  const button = event.target.closest('button');
  const icon = button.querySelector('span:first-child');
  
  if (icon.textContent === '🔖') {
    icon.textContent = '📑';
    button.classList.add('active');
  } else {
    icon.textContent = '🔖';
    button.classList.remove('active');
  }
}

function addNote() {
  const note = prompt('이 문제에 대한 메모를 추가하세요:');
  if (note) {
    alert('메모가 저장되었습니다: ' + note);
  }
}
</script>