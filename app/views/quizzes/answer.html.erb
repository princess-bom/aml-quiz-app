<% content_for :page_title, "í€´ì¦ˆ" %>
<% content_for :back_button do %>
  <%= link_to quiz_selection_path, class: "mobile-header-back" do %>
    <span class="mobile-header-back-icon">â†</span>
  <% end %>
<% end %>

<!-- Answer Result Alert -->
<% if @is_correct %>
  <div class="alert alert--quiz-success">
    <div class="alert-content">
      <div class="alert-icon">âœ…</div>
      <div class="alert-text">
        <h3 class="alert-title">ì •ë‹µì…ë‹ˆë‹¤!</h3>
        <p class="alert-description">+<%= @current_quiz&.points || 5 %>ì  íšë“</p>
      </div>
    </div>
  </div>
<% else %>
  <div class="alert alert--quiz-incorrect">
    <div class="alert-content">
      <div class="alert-icon">âŒ</div>
      <div class="alert-text">
        <h3 class="alert-title">í‹€ë ¸ìŠµë‹ˆë‹¤</h3>
        <p class="alert-description">ì˜¤ë‹µ ë…¸íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>
<% end %>

<!-- Answer Review -->
<div class="card card--<%= @is_correct ? 'quiz' : 'wrong-answer' %>">
  <div class="card-header">
    <h3 class="card-title">ì •ë‹µ í™•ì¸</h3>
  </div>
  
  <div class="card-content">
    <div class="dashboard-stats">
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-title">ì •ë‹µ</div>
        <div class="dashboard-stat-value" style="color: var(--success-600);">
          <%= @current_quiz&.correct_answer || "C" %>. <%= @current_quiz&.answer_text || "1000ë§Œì› ì´ìƒ" %>
        </div>
      </div>
      
      <div class="dashboard-stat-card">
        <div class="dashboard-stat-title">ë‹¹ì‹ ì˜ ë‹µì•ˆ</div>
        <div class="dashboard-stat-value" style="color: <%= @is_correct ? 'var(--success-600)' : 'var(--error-600)' %>;">
          <%= @selected_answer || "C" %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Explanation -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">ğŸ’¡ í•´ì„¤</h3>
  </div>
  
  <div class="card-content">
    <p class="quiz-explanation">
      <%= @current_quiz&.explanation || "ìê¸ˆì„¸íƒë°©ì§€ë²• ì œ4ì¡°ì— ë”°ë¼ 1000ë§Œì› ì´ìƒì˜ ê±°ë˜ ì‹œ ê³ ê°í™•ì¸ì˜ë¬´ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì´ëŠ” ê¸ˆìœµê¸°ê´€ì˜ í•µì‹¬ ì˜ë¬´ì‚¬í•­ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤." %>
    </p>
    
    <div style="margin-top: var(--space-4);">
      <h4 class="card-title">ğŸ“š ê´€ë ¨ ë²•ì¡°ë¬¸</h4>
      <ul style="margin: var(--space-2) 0; padding-left: var(--space-4);">
        <li>â€¢ ìê¸ˆì„¸íƒë°©ì§€ë²• ì œ4ì¡°</li>
        <li>â€¢ ì‹œí–‰ë ¹ ì œ7ì¡°</li>
      </ul>
    </div>
  </div>
</div>

<!-- Action Buttons -->
<div class="button-group" style="margin-top: var(--space-6);">
  <% if @quiz_session&.current_quiz_index && @quiz_session.current_quiz_index < 20 %>
    <%= link_to next_question_path(@quiz_session), class: "button button--next-question button--lg w-full" do %>
      ë‹¤ìŒ ë¬¸ì œ
    <% end %>
  <% else %>
    <%= link_to quiz_result_path(@quiz_session), class: "button button--view-results button--lg w-full" do %>
      ê²°ê³¼ ë³´ê¸°
    <% end %>
  <% end %>
</div>

<!-- Additional Actions -->
<div class="button-group button-group--horizontal" style="margin-top: var(--space-4);">
  <button class="button button--outline" onclick="toggleBookmark()">
    <span>ğŸ”–</span>
    <span>ë¶ë§ˆí¬</span>
  </button>
  
  <button class="button button--outline" onclick="addNote()">
    <span>ğŸ“</span>
    <span>ë©”ëª¨</span>
  </button>
</div>

<!-- Quiz Completion Modal -->
<% if @show_completion %>
  <div class="dialog-overlay open">
    <div class="dialog dialog--confirmation success">
      <div class="dialog-content">
        <div class="dialog-icon">ğŸ‰</div>
        <h3 class="dialog-title">í€´ì¦ˆ ì™„ë£Œ!</h3>
        <p class="dialog-message">
          ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.<br>
          ìµœì¢… ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.
        </p>
      </div>
      
      <div class="dialog-footer">
        <%= link_to quiz_result_path(@quiz_session), class: "button button--success button--lg" do %>
          ê²°ê³¼ í™•ì¸
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<style>
.quiz-explanation {
  line-height: var(--leading-relaxed);
  color: var(--text-primary);
  font-size: var(--text-base);
}

.alert--quiz-success {
  background: var(--success-50);
  border-color: var(--success-300);
  color: var(--success-800);
}

.alert--quiz-incorrect {
  background: var(--error-50);
  border-color: var(--error-300);
  color: var(--error-800);
}
</style>

<script>
function toggleBookmark() {
  const button = event.target.closest('button');
  const icon = button.querySelector('span:first-child');
  
  if (icon.textContent === 'ğŸ”–') {
    icon.textContent = 'ğŸ“‘';
    button.classList.add('active');
  } else {
    icon.textContent = 'ğŸ”–';
    button.classList.remove('active');
  }
}

function addNote() {
  const note = prompt('ì´ ë¬¸ì œì— ëŒ€í•œ ë©”ëª¨ë¥¼ ì¶”ê°€í•˜ì„¸ìš”:');
  if (note) {
    alert('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤: ' + note);
  }
}
</script>